<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bandejita de Lata - Men√∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #FF4500; --gold: #FFD700; --dark: #1a1a1a; --light: #f4f4f4; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--light); color: var(--dark); padding-bottom: 80px; }
        
        /* HEADER */
        header {
            height: 35vh;
            background-image: url('https://images.unsplash.com/photo-1626844131082-256783844137?q=80&w=1935&auto=format&fit=crop'); 
            background-size: cover; background-position: center; background-attachment: fixed;
            display: flex; align-items: center; justify-content: center; position: relative;
        }
        header::after { content: ''; position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); }
        .header-content { position: relative; z-index: 2; text-align: center; color: white; padding: 20px; }
        h1 { font-family: 'Oswald', sans-serif; font-size: 2.5rem; margin: 0; text-transform: uppercase; }
        .subtitle { font-size: 1rem; margin-top: 5px; opacity: 0.9; }

        /* CONTENEDOR */
        .container { max-width: 600px; margin: -40px auto 0; padding: 15px; position: relative; z-index: 3; }
        
        /* TARJETAS */
        .card {
            background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid transparent;
        }
        .card.destacado { border: 2px solid var(--gold); background-color: #fffdf0; position: relative; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .badge-star { position: absolute; top: -12px; right: 20px; background-color: var(--gold); color: #000; font-size: 0.7rem; font-weight: bold; padding: 4px 10px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .info { flex: 1; padding-right: 10px; }
        .dish-name { font-family: 'Oswald', sans-serif; font-size: 1.2rem; margin: 0 0 4px 0; color: var(--dark); }
        .dish-desc { font-size: 0.85rem; color: #666; margin: 0; line-height: 1.4; }
        .price-tag { text-align: right; min-width: 70px; }
        .usd { font-size: 1.3rem; font-weight: bold; color: var(--primary); display: block; }
        
        /* BOT√ìN FLOTANTE */
        .fab {
            position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white;
            padding: 12px 25px; border-radius: 50px; font-weight: bold; text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; z-index: 100;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Bandejita de Lata</h1>
            <p class="subtitle">Men√∫ Digital</p>
        </div>
    </header>

    <div class="container" id="menu-container">
        <p style="text-align: center; color: #888;">Cargando men√∫...</p>
    </div>

    <a href="#" id="whatsapp-btn" class="fab">Hacer Pedido üí¨</a>

    <script>
        // ================= CONFIGURACI√ìN =================
        const TELEFONO = "58424xxxxxxx"; 
        // üëá PEGA TU ENLACE CSV AQU√ç (Aseg√∫rate que termine en .csv)
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSfR6ILf3cDq51hVw-GBANJ1wpfH5NrKgBgPvaYMAUeSiWLpWUCsCPJIkA5m-Ok1E7NpPtJtLzfAURH/pub?gid=0&single=true&output=csv"; 
        // =================================================

        // 1. RASTREO
        const params = new URLSearchParams(window.location.search);
        let origen = params.get('origen') || 'web';
        document.getElementById('whatsapp-btn').href = `https://wa.me/${TELEFONO}?text=${encodeURIComponent("Hola Angel, vengo de " + origen + " y quiero pedir:")}`;

        // 2. PARSEADOR CSV INTELIGENTE (ESTO ES LO NUEVO)
        function csvToArrays(strData) {
            const arr = [];
            let quote = false;  // 'true' significa que estamos dentro de una frase con comillas
            let col = 0, c = 0;
            for (; c < strData.length; c++) {
                let cc = strData[c], nc = strData[c+1];
                arr[col] = arr[col] || [];
                arr[col].push(cc);
                
                // Si encontramos comillas, cambiamos el estado
                if (cc == '"' && quote && nc == '"') { arr[col].pop(); arr[col].push(cc); ++c; continue; }
                if (cc == '"') { arr[col].pop(); quote = !quote; continue; }
                
                // Si es coma y NO estamos en comillas, es nueva columna
                if (cc == ',' && !quote) { arr[col].pop(); arr[++col] = []; continue; }
                
                // Si es salto de l√≠nea y NO estamos en comillas, es nueva fila
                if (cc == '\r' && nc == '\n' && !quote) { arr[col].pop(); return arr; }
                if (cc == '\n' && !quote) { arr[col].pop(); return arr; }
            }
            return arr;
        }

        function parseCSV(text) {
            let filas = [];
            let filaActual = [];
            let celda = "";
            let enComillas = false;

            for (let i = 0; i < text.length; i++) {
                let char = text[i];
                let nextChar = text[i+1];

                if (char === '"') {
                    if (enComillas && nextChar === '"') { celda += '"'; i++; } 
                    else { enComillas = !enComillas; }
                } else if (char === ',' && !enComillas) {
                    filaActual.push(celda); celda = "";
                } else if (char === '\n' && !enComillas) {
                    filaActual.push(celda); filas.push(filaActual); filaActual = []; celda = "";
                } else if (char !== '\r') {
                    celda += char;
                }
            }
            if (celda || filaActual.length > 0) { filaActual.push(celda); filas.push(filaActual); }
            return filas;
        }

        // 3. CARGAR
        async function cargarMenu() {
            try {
                if(SHEET_CSV_URL.includes("PEGAR_ENLACE")) {
                    document.getElementById('menu-container').innerHTML = '<p style="text-align:center; color:red">‚ö†Ô∏è Falta pegar el enlace CSV en el c√≥digo.</p>';
                    return;
                }

                const response = await fetch(SHEET_CSV_URL);
                if (!response.ok) throw new Error("Error de conexi√≥n");
                const data = await response.text();
                
                // USAMOS EL NUEVO PARSEADOR
                const filas = parseCSV(data);
                
                const contenedor = document.getElementById('menu-container');
                contenedor.innerHTML = ''; 
                let destacados = [], normales = [];

                filas.forEach((fila, index) => {
                    if (index === 0) return; // Saltar encabezado

                    // COLUMNAS SEG√öN TU HOJA: [0]=Nombre, [1]=Desc, [2]=Precio, [4]=Disp, [5]=Destacado
                    // Limpiamos comillas extra que a veces quedan
                    const nombre = fila[0] ? fila[0].trim() : '';
                    const desc = fila[1] ? fila[1].trim() : '';
                    const precio = fila[2] ? fila[2].replace('$', '').trim() : '';
                    const disponible = fila[4] ? fila[4].toLowerCase().trim() : '';
                    const destacado = fila[5] ? fila[5].toLowerCase().trim() : '';

                    if (nombre && disponible === 'si') {
                        const esDestacado = destacado === 'si';
                        const html = `
                            <div class="card ${esDestacado ? 'destacado' : ''}">
                                ${esDestacado ? '<div class="badge-star">‚≠ê RECOMENDADO</div>' : ''}
                                <div class="info">
                                    <h3 class="dish-name">${nombre}</h3>
                                    <p class="dish-desc">${desc}</p>
                                </div>
                                <div class="price-tag"><span class="usd">$${precio}</span></div>
                            </div>
                        `;
                        esDestacado ? destacados.push(html) : normales.push(html);
                    }
                });

                if(destacados.length === 0 && normales.length === 0) {
                     contenedor.innerHTML = '<p style="text-align:center">No hay platos disponibles (Revisa la columna "Disponible" en tu hoja).</p>';
                } else {
                    contenedor.innerHTML = destacados.join('') + normales.join('');
                }

            } catch (error) {
                console.error(error);
                document.getElementById('menu-container').innerHTML = `<p style="text-align:center; color:red">Error cargando men√∫: ${error.message}</p>`;
            }
        }

        cargarMenu();
    </script>
</body>
</html>
